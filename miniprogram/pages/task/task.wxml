<view class="nav" style="padding-top: {{statusBarHeight + 10}}px;">
  <text class="title">任务详情</text>
</view>
<swiper indicator-dots="{{false}}" autoplay="{{false}}" indicator-type="expand" transformer-type="scaleAndFade"
  circular="false" interval="3000" duration="500" class="swiper-component" bindchange="onSwiperChange">

  <block wx:for="{{taskDetail}}" wx:for-item="task" wx:for-index="tIndex" wx:key="tIndex">
    <swiper-item>
      <scroll-view scroll-y class="scroll">
        <!-- Header -->
        <view class="header">
          <view class="header-word">{{task.data}}</view>
          <view class="header-subtitle">{{task.sentenseText}}</view>
          <view class="header-option">
            <text class="source">选项{{tIndex + 1}}</text>
            <text>{{ status === 'completed' ? "任务":"数据"}}来源：{{task.source_name}}</text>
          </view>
        </view>


        <!-- 粤语 pronunciations -->
        <block wx:for="{{task.cantonesePronunciations}}" wx:for-item="cp" wx:for-index="index" wx:key="index">
          <view class="group-wrapper">
            <van-cell-group inset>
              <van-cell title="粤音{{index + 1}}：" value="{{cp}}" size="large" custom-class="custom-cell"
                title-width="100px" />
            </van-cell-group>
          </view>
        </block>
        <block wx:if="{{task.new}}">
          <block wx:for="{{cantonesePronunciations}}" wx:for-index="cpIndex" wx:key="cpIndex">
            <view class="group-wrapper">
              <van-cell-group inset>
                <van-field label="粤语{{cpIndex + 1}}：" size="large" custom-class="custom-cell" data-index="{{cpIndex}}"
                  data-type="cantonesePronunciations" bind:change="onFieldChange" />
                <van-cell title="操作">
                  <van-icon slot="right-icon" name="add" size="36px" bind:click="onAddCellClick"
                    data-type="cantonesePronunciations" />
                  <van-icon wx:if="{{cpIndex > 0}}" slot="right-icon" name="clear" size="36px"
                    bind:click="onRemoveCellClick" data-type="cantonesePronunciations" />
                </van-cell>
              </van-cell-group>
            </view>
          </block>
        </block>


        <!-- 词组 -->
        <block wx:if="{{task.phrases_join}}">
          <view class="group-wrapper">
            <van-cell-group inset>
              <van-cell title="词组：" value="{{task.phrases_join}}" size="large" custom-class="custom-cell"
                title-width="100px" />
            </van-cell-group>
          </view>
        </block>
        <block wx:if="{{task.new}}">
          <block wx:for="{{phrases}}" wx:for-index="pIndex" wx:key="pIndex">
            <view class="group-wrapper">
              <van-cell-group inset>
                <van-field label="词组{{pIndex + 1}}：" size="large" custom-class="custom-cell" data-index="{{pIndex}}"
                  data-type="phrases" bind:change="onFieldChange" />
                <van-cell title="操作">
                  <van-icon slot="right-icon" name="add" size="36px" bind:click="onAddCellClick" data-type="phrases" />
                  <van-icon wx:if="{{pIndex > 0}}" slot="right-icon" name="clear" size="36px"
                    bind:click="onRemoveCellClick" data-type="phrases" />
                </van-cell>
              </van-cell-group>
            </view>
          </block>
        </block>


        <!-- 情感 sentiments -->
        <block wx:if="{{task.sentiments}}">
          <block wx:for="{{task.sentiments}}" wx:for-item="sens" wx:for-index="sIndex" wx:key="sIndex">
            <view class="group-wrapper">
              <van-cell-group inset>
                <van-cell title="情感{{sIndex + 1}}：" value="{{sens.sentiment}}" size="large"
                  custom-class="custom-cell" />
                <van-cell title="例句：" value="{{sens.exampleSentences ? sens.exampleSentences.join('; ') : ''}}"
                  size="large" custom-class="custom-cell" />
              </van-cell-group>
            </view>
          </block>
        </block>
        <block wx:if="{{task.new}}">
          <block wx:for="{{sentiments}}" wx:for-item="sens_new" wx:for-index="sIdx" wx:key="sIdx">
            <view class="group-wrapper">
              <van-cell-group inset>
                <!-- <van-cell title="情感{{sIdx + 1}}：" value="" size="large" custom-class="custom-cell" /> -->
                <van-field label="情感{{sIdx + 1}}：" size="large" custom-class="custom-cell" data-index="{{sIdx}}"
                  data-type="sentiment" bind:change="onSentimentsFieldChange" />
                <!-- <van-cell title="例句：" value="" size="large" custom-class="custom-cell" /> -->
                <van-field label="例句：" size="large" custom-class="custom-cell" data-index="{{sIdx}}"
                  data-type="exampleSentences" bind:change="onSentimentsFieldChange" />
                <van-cell title="操作">
                  <van-icon slot="right-icon" name="add" size="36px" bind:click="onAddCellClick"
                    data-type="sentiments" />
                  <van-icon wx:if="{{sIdx > 0}}" slot="right-icon" name="clear" size="36px"
                    bind:click="onRemoveCellClick" data-type="phrases" />
                </van-cell>
              </van-cell-group>
            </view>
          </block>
        </block>

        <block wx:if="{{task.source === 'llm'}}">
          <view class="group-wrapper">
            <van-cell-group inset>
              <van-cell title="解释：" value="{{task.suggestions.explanation}}" size="large" custom-class="custom-cell"
                title-width="100px" />
            </van-cell-group>
          </view>
        </block>

        <block wx:if="{{status === 'completed'}}">
          <view class="group-wrapper">
            <van-cell-group inset>
              <van-cell title="处理时间：" value="{{completedAt}}" size="large" custom-class="custom-cell"
                title-width="100px" />
            </van-cell-group>
          </view>
        </block>
        <block wx:if="{{status === 'completed'}}">
          <view class="group-wrapper">
            <van-cell-group inset>
              <van-cell title="状态：" value="已处理" size="large" custom-class="custom-cell" title-width="100px" />
            </van-cell-group>
          </view>
        </block>
      </scroll-view>

    </swiper-item>
  </block>
</swiper>

<block wx:if="{{status !== 'completed' && taskDetail.length > 0 }}">
  <view class="info-text">
    <van-icon name="warning-o" />
    <text class="info-message">请向左滑动查看选项</text>
  </view>
</block>
<!-- 自定义指示点 -->
<view class="custom-dots" wx:if="{{status !== 'completed'}}">
  <view wx:for="{{taskDetail}}" wx:for-index="index" wx:key="index"
    class="dot {{index === currentIndex ? 'active' : ''}}"></view>
  <!-- <van-icon name="add" color="#DFE0E3" size="36px" bind:click="onAddClick" class="add-icon {{hidden ? 'hide' : ''}}" /> -->
</view>



<!-- 底部按钮 -->
<view class="footer" wx:if="{{status !== 'completed'}}">
  <van-button type="default" round color="#181818" bind:click="onCancel" class="btn-cancel"
    custom-style="color: #DFE0E3;">不处理</van-button>

  <van-button type="default" round color="#DFE0E3" bind:click="onSubmit" class="btn-submit" custom-style="color: #000;">
    正确</van-button>
</view>